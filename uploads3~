#!/bin/bash

source /mnt/dlink_nfs/backup-script/var-dec

if pidof -x "$script_name" -o $$ >/dev/null;then
   echo "An another instance of this script is already running"
   exit 1
fi

if [[ $1 == 'clean' ]]
	then
		echo "clean command passed"
		exit 1
else
	if mountpoint -q /mnt/samba
		then
		rsync -vruO --delete-after $FOLDER_NFS/backup-test /mnt/samba/
		fi

	cd $FOLDER_NFS/backup-test/

	shopt -s dotglob
	shopt -s nullglob
	array=(*/)
	echo runing s3

	for dir in "${array[@]}"
	 do 
		echo "Currently Running S3 on $dir"
		dir=${dir%/}
	  #      timeout 30m s3cmd $s3_cmd $dir $s3_bucket

	 done
fi
